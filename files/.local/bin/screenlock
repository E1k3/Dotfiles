#!/bin/sh
pixelation=20
blur=4

if [[ -n "$1" && "$1" != "-n" ]]; then
	echo -e "Usage: $0 [-n]\n\t-n\tStarts i3lock with --no-fork option"
	exit 1
fi

if ! pgrep i3lock > /dev/null; then
	scrot -om /tmp/screen_locked.png

	ffmpeg -i /tmp/screen_locked.png -y -v error -vf "scale=w=iw/$pixelation:h=-1:flags=neighbor,scale=w=iw*$pixelation:h=-1:flags=neighbor,boxblur=luma_radius=$blur:chroma_radius=$blur" /tmp/screen_blurred.png

	rm /tmp/screen_locked.png

	i3lock "$1" -i /tmp/screen_blurred.png
fi
